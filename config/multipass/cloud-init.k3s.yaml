#cloud-config
# Cloud-init configuration for K3s nodes
# Installs K3s lightweight Kubernetes for local development

# Update system packages
package_update: true
package_upgrade: true

# Install required packages
packages:
  - curl
  - wget
  - git
  - net-tools
  - vim
  - htop
  - jq
  - apt-transport-https
  - ca-certificates
  - nfs-common

# Configure users and groups
users:
  - default

# K3s will be installed via runcmd based on node role
# Server nodes (managers) will be identified and configured by the multipass.sh script
# Agent nodes (workers) will join the cluster automatically

runcmd:
  # Create directory for K3s configuration
  - mkdir -p /etc/rancher/k3s

  # Install K3s prerequisites
  - sysctl -w net.ipv4.ip_forward=1
  - echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf

  # Note: K3s installation will be handled by multipass.sh script
  # This allows dynamic server/agent configuration based on node role

# Set timezone
timezone: UTC

# Final message
final_message: "K3s node ready at $HOSTNAME ($PUBLIC_IPV4) - K3s will be configured by cluster setup script"
